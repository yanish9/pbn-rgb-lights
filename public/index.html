<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Groups & Color Sender</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .btn-custom { border: 2px solid #6c757d; border-radius: 10px; min-width: 50px; }
    .palette { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
    .swatch { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer; }
    .swatch:hover { border-color: #000; }
  </style>
</head>
<body class="bg-light p-4">
  <div class="container">
    <h1 class="mb-4">Groups & Color Sender</h1>
    <div class="row">
      <!-- LEFT COLUMN -->
      <div class="col-md-6">
        <!-- Group 1 -->
        <div class="mb-3 border rounded p-3" data-group="1">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="m-0">Group 1 (7 buttons)</h5>
            <button class="btn btn-primary w-100 py-2 mt-2" data-role="all" data-group="1">All</button>
          </div>
          <div class="d-flex gap-2 flex-wrap" id="group1"></div>
        </div>

        <!-- Group 3 -->
        <div class="mb-3 border rounded p-3" data-group="3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="m-0">Group 3 (2 buttons)</h5>
            <button class="btn btn-primary w-100 py-2 mt-2" data-role="all" data-group="3">All</button>
          </div>
          <div class="d-flex gap-2 flex-wrap" id="group3"></div>
        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="col-md-6">
        <!-- Group 2 -->
        <div class="mb-3 border rounded p-3" data-group="2">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="m-0">Group 2 (7 buttons)</h5>
            <button class="btn btn-primary w-100 py-2 mt-2" data-role="all" data-group="2">All</button>
          </div>
          <div class="d-flex gap-2 flex-wrap" id="group2"></div>
        </div>

        <!-- Group 4 -->
        <div class="mb-3 border rounded p-3" data-group="4">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="m-0">Group 4 (2 buttons)</h5>
            <button class="btn btn-primary w-100 py-2 mt-2" data-role="all" data-group="4">All</button>
          </div>
          <div class="d-flex gap-2 flex-wrap" id="group4"></div>
        </div>
      </div>
    </div>

    <h4 class="mt-4">Pick a Color</h4>
    <div class="palette" id="palette"></div>

    <div class="mt-3">
      <strong>Last Sent:</strong> <span id="status">n/a</span>
    </div>
  </div>

  <script>
    // Per-group IDs start at 1
    const groups = {
      1: { containerId: "group1", ids: [1,2,3,4,5,6,7] },
      2: { containerId: "group2", ids: [1,2,3,4,5,6,7] },
      3: { containerId: "group3", ids: [1,2] },
      4: { containerId: "group4", ids: [1,2] },
    };

    // Fixed palette
    const colors = [
      { name: "Red", rgb: "255,0,0" },
      { name: "Green", rgb: "0,255,0" },
      { name: "Blue", rgb: "0,0,255" },
      { name: "Yellow", rgb: "255,255,0" },
      { name: "Cyan", rgb: "0,255,255" },
      { name: "Magenta", rgb: "255,0,255" },
      { name: "Orange", rgb: "255,165,0" },
      { name: "White", rgb: "255,255,255" },
      { name: "Black", rgb: "0,0,0" }
    ];

    // Build buttons
    Object.entries(groups).forEach(([groupNum, cfg]) => {
      const el = document.getElementById(cfg.containerId);
      cfg.ids.forEach((id) => {
        const b = document.createElement("button");
        b.className = "btn btn-outline-secondary btn-custom";
        b.textContent = id;
        b.dataset.id = id;            // per-group button id
        b.dataset.group = groupNum;   // group number
        el.appendChild(b);
      });
    });

    // Build palette
    const palette = document.getElementById("palette");
    colors.forEach(c => {
      const div = document.createElement("div");
      div.className = "swatch";
      div.style.background = `rgb(${c.rgb})`;
      div.dataset.rgb = c.rgb;
      div.title = c.name;
      palette.appendChild(div);
    });

    let selectedColor = colors[2].rgb; // default Blue
    // Show selected outline
    setTimeout(() => {
      const defaultSwatch = [...document.querySelectorAll(".swatch")]
        .find(s => s.dataset.rgb === selectedColor);
      if (defaultSwatch) defaultSwatch.style.outline = "3px solid black";
    });

    // Handle palette click
    palette.addEventListener("click", e => {
      if (e.target.classList.contains("swatch")) {
        selectedColor = e.target.dataset.rgb;
        document.querySelectorAll(".swatch").forEach(s => s.style.outline = "");
        e.target.style.outline = "3px solid black";
      }
    });

    // Delegate clicks: individual buttons and "All"
    document.body.addEventListener("click", async e => {
      const target = e.target;

      // "All" buttons
      if (target.matches('[data-role="all"]')) {
        const group = Number(target.dataset.group);
        await sendPayload({ group, id: "all", color: selectedColor });
        return;
      }

      // Individual buttons
      if (target.dataset && target.dataset.id && target.dataset.group) {
        if (!selectedColor) { alert("Pick a color first!"); return; }
        const id = String(target.dataset.id);
        const group = Number(target.dataset.group);
        await sendPayload({ group, id, color: selectedColor });
      }
    });

    async function sendPayload(payload) {
      // Update UI
      document.getElementById("status").textContent = JSON.stringify(payload);

      try {
        const res = await fetch("/api/color", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        if (!res.ok) throw new Error("HTTP " + res.status);
      } catch (err) {
        console.error("Send failed:", err);
        alert("Failed to send color. See console.");
      }
    }
  </script>
</body>
</html>
